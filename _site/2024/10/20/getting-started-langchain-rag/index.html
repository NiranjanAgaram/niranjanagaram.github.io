<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="After months of hearing about RAG and LangChain, I finally built my first retrieval-augmented generation system. Here&#39;s what I learned.">
    <meta name="author" content="Niranjan Agaram">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="post">
    <meta property="og:url" content="http://localhost:4009/2024/10/20/getting-started-langchain-rag/">
    <meta property="og:title" content="Building RAG Systems: My Journey with LangChain">
    <meta property="og:description" content="After months of hearing about RAG and LangChain, I finally built my first retrieval-augmented generation system. Here&#39;s what I learned.">
    <meta property="og:image" content="http://localhost:4009/assets/images/og-image.svg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="http://localhost:4009/2024/10/20/getting-started-langchain-rag/">
    <meta property="twitter:title" content="Building RAG Systems: My Journey with LangChain">
    <meta property="twitter:description" content="After months of hearing about RAG and LangChain, I finally built my first retrieval-augmented generation system. Here&#39;s what I learned.">
    <meta property="twitter:image" content="http://localhost:4009/assets/images/og-image.svg">
    
    <!-- Enhanced Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Person",
      "name": "Niranjan Agaram",
      "jobTitle": "AI & Data Engineering Consultant",
      "description": "10+ years evolving from data engineering to agentic AI systems across healthcare, retail, marketing, and real estate",
      "url": "http://localhost:4009",
      "sameAs": [
        "https://linkedin.com/in/niranjan-agaram",
        "https://github.com/niranjanagaram"
      ],
      "knowsAbout": [
        "Artificial Intelligence",
        "Data Engineering", 
        "Machine Learning",
        "LangChain",
        "CrewAI",
        "FastAPI",
        "Python",
        "SAS",
        "Multi-Agent Systems"
      ],
      "hasOccupation": {
        "@type": "Occupation",
        "name": "AI Consultant",
        "occupationLocation": {
          "@type": "Country",
          "name": "India"
        }
      }
    }
    </script>
    
    <title>Building RAG Systems: My Journey with LangChain</title>
    <link rel="canonical" href="http://localhost:4009/2024/10/20/getting-started-langchain-rag/">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Niranjan AI">
    <script src="/assets/js/main.js" defer></script>
    <script src="/assets/js/search.js" defer></script>
    <script src="/assets/js/performance.js" defer></script>
    
    <!-- Analytics -->
    
</head>
<body>

    <div class="bg-orb orb-1" aria-hidden="true"></div>
    <div class="bg-orb orb-2" aria-hidden="true"></div>
    
    <!-- Progress Bar -->
    <div class="reading-progress" id="reading-progress" aria-hidden="true"></div>
    
    <header role="banner">
        <div class="container">
            <h1><a href="/" aria-label="Home - Niranjan's AI Insights">Niranjan's AI Insights</a></h1>
            <p>Enterprise AI solutions, agentic systems, and intelligent automation insights from a senior data engineer</p>
            
            <!-- Search -->
            <div class="search-container">
                <input type="search" id="search-input" placeholder="Search posts..." aria-label="Search blog posts">
                <div id="search-results" class="search-results" aria-live="polite"></div>
            </div>
            
            <nav role="navigation" aria-label="Main navigation">
                <div class="nav-links">
                    <a href="/" >Home</a>
                    <a href="/posts" >Posts</a>
                    <a href="/services" >Services</a>
                    <a href="/about" >About</a>
                    <a href="/contact" >Contact</a>
                    <a href="/archive" >Archive</a>
                </div>
                <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark/light mode"></button>
            </nav>
        </div>
    </header>
    
    <main id="main-content" class="container" role="main">
        <article itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    <h1 itemprop="headline">Building RAG Systems: My Journey with LangChain</h1>
    <div class="post-meta">
      <time datetime="2024-10-20T00:00:00+05:30" itemprop="datePublished">
        October 20, 2024
      </time>
      
        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
          by <span itemprop="name">Niranjan Agaram</span>
        </span>
      
      <span class="reading-time">üìñ 13 min read</span>
    </div>
    
    <div class="tags">
      
        <span class="tag" itemprop="keywords">langchain</span>
      
        <span class="tag" itemprop="keywords">rag</span>
      
        <span class="tag" itemprop="keywords">ai</span>
      
        <span class="tag" itemprop="keywords">llm</span>
      
        <span class="tag" itemprop="keywords">vector-databases</span>
      
    </div>
    
  </header>

  <div itemprop="articleBody">
    <h1 id="building-rag-systems-my-journey-with-langchain">Building RAG Systems: My Journey with LangChain</h1>

<p>I‚Äôve been putting off learning about RAG (Retrieval-Augmented Generation) for months. Every AI meetup, every blog post, every LinkedIn update seemed to mention it. Finally, when our hospital asked for a ‚Äúsmart document search system‚Äù for medical protocols, I couldn‚Äôt avoid it anymore.</p>

<p>This is the story of building my first RAG system with LangChain, and why it took me 3 weeks to get something that actually worked.</p>

<h2 id="what-i-thought-rag-was">What I Thought RAG Was</h2>

<p>Before diving in, my understanding of RAG was pretty basic:</p>
<ol>
  <li>Store documents in a vector database</li>
  <li>When user asks a question, find relevant documents</li>
  <li>Feed documents + question to an LLM</li>
  <li>Get a smart answer</li>
</ol>

<p>Simple, right? Well, the concept is simple. The implementation‚Ä¶ not so much.</p>

<h2 id="the-use-case">The Use Case</h2>

<p>Our hospital has hundreds of medical protocols, guidelines, and procedures scattered across PDFs, Word docs, and internal wikis. Doctors and nurses waste time searching for specific information during critical moments.</p>

<p>The ask: ‚ÄúCan we build something where they can just ask questions and get answers from our documents?‚Äù</p>

<h2 id="setting-up-langchain-first-frustration">Setting Up LangChain (First Frustration)</h2>

<p>Installing LangChain looked straightforward:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>langchain
</code></pre></div></div>

<p>But then I needed vector storage, embeddings, and an LLM. Each required different packages:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip <span class="nb">install </span>langchain-openai
pip <span class="nb">install </span>langchain-community
pip <span class="nb">install </span>chromadb
pip <span class="nb">install </span>pypdf
pip <span class="nb">install </span>tiktoken
</code></pre></div></div>

<p>And that was just the beginning. Different tutorials used different combinations of packages, and half of them were outdated.</p>

<h2 id="attempt-1-the-basic-tutorial-approach">Attempt 1: The Basic Tutorial Approach</h2>

<p>Following a YouTube tutorial, I built this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">langchain.document_loaders</span> <span class="kn">import</span> <span class="n">PyPDFLoader</span>
<span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">CharacterTextSplitter</span>
<span class="kn">from</span> <span class="nn">langchain.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
<span class="kn">from</span> <span class="nn">langchain.vectorstores</span> <span class="kn">import</span> <span class="n">Chroma</span>
<span class="kn">from</span> <span class="nn">langchain.chains</span> <span class="kn">import</span> <span class="n">RetrievalQA</span>
<span class="kn">from</span> <span class="nn">langchain.llms</span> <span class="kn">import</span> <span class="n">OpenAI</span>

<span class="c1"># Load documents
</span><span class="n">loader</span> <span class="o">=</span> <span class="n">PyPDFLoader</span><span class="p">(</span><span class="s">"medical_protocols.pdf"</span><span class="p">)</span>
<span class="n">documents</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">()</span>

<span class="c1"># Split text
</span><span class="n">text_splitter</span> <span class="o">=</span> <span class="n">CharacterTextSplitter</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">chunk_overlap</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">texts</span> <span class="o">=</span> <span class="n">text_splitter</span><span class="p">.</span><span class="n">split_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

<span class="c1"># Create embeddings and vector store
</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">(</span><span class="n">openai_api_key</span><span class="o">=</span><span class="s">"your-api-key-here"</span><span class="p">)</span>
<span class="n">vectorstore</span> <span class="o">=</span> <span class="n">Chroma</span><span class="p">.</span><span class="n">from_documents</span><span class="p">(</span><span class="n">texts</span><span class="p">,</span> <span class="n">embeddings</span><span class="p">)</span>

<span class="c1"># Create QA chain
</span><span class="n">qa</span> <span class="o">=</span> <span class="n">RetrievalQA</span><span class="p">.</span><span class="n">from_chain_type</span><span class="p">(</span>
    <span class="n">llm</span><span class="o">=</span><span class="n">OpenAI</span><span class="p">(</span><span class="n">openai_api_key</span><span class="o">=</span><span class="s">"your-api-key-here"</span><span class="p">),</span>
    <span class="n">chain_type</span><span class="o">=</span><span class="s">"stuff"</span><span class="p">,</span>
    <span class="n">retriever</span><span class="o">=</span><span class="n">vectorstore</span><span class="p">.</span><span class="n">as_retriever</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># Ask questions
</span><span class="n">response</span> <span class="o">=</span> <span class="n">qa</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="s">"What is the protocol for chest pain patients?"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Result</strong>: It worked! Sort of. The answers were generic and often missed important details from our specific protocols.</p>

<h2 id="the-problems-i-discovered">The Problems I Discovered</h2>

<h3 id="1-chunking-strategy-matters">1. Chunking Strategy Matters</h3>

<p>My first approach split documents at arbitrary 1000-character boundaries. This often broke up important information:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Chunk 1: "For chest pain patients, first assess vital signs and..."
Chunk 2: "...then immediately administer aspirin unless contraindicated by..."
</code></pre></div></div>

<p>When the system retrieved Chunk 1, it missed the crucial aspirin instruction.</p>

<p><strong>Better approach</strong>:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>

<span class="n">text_splitter</span> <span class="o">=</span> <span class="n">RecursiveCharacterTextSplitter</span><span class="p">(</span>
    <span class="n">chunk_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">chunk_overlap</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">separators</span><span class="o">=</span><span class="p">[</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">". "</span><span class="p">,</span> <span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div></div>

<p>This preserved more context by splitting on natural boundaries.</p>

<h3 id="2-retrieval-quality-was-poor">2. Retrieval Quality Was Poor</h3>

<p>The system often retrieved irrelevant chunks. When I asked about ‚Äúchest pain protocols,‚Äù it sometimes returned information about ‚Äúchest X-ray procedures‚Äù because they shared similar words.</p>

<p><strong>Solution</strong>: Better embeddings and retrieval parameters:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Use more relevant retrieval
</span><span class="n">retriever</span> <span class="o">=</span> <span class="n">vectorstore</span><span class="p">.</span><span class="n">as_retriever</span><span class="p">(</span>
    <span class="n">search_type</span><span class="o">=</span><span class="s">"similarity_score_threshold"</span><span class="p">,</span>
    <span class="n">search_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">"score_threshold"</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s">"k"</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="3-no-source-attribution">3. No Source Attribution</h3>

<p>The system gave answers but didn‚Äôt tell me which document they came from. For medical protocols, this is crucial for verification.</p>

<h2 id="attempt-2-custom-rag-pipeline">Attempt 2: Custom RAG Pipeline</h2>

<p>I rebuilt the system with more control over each step:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">langchain.document_loaders</span> <span class="kn">import</span> <span class="n">DirectoryLoader</span><span class="p">,</span> <span class="n">PyPDFLoader</span>
<span class="kn">from</span> <span class="nn">langchain.text_splitter</span> <span class="kn">import</span> <span class="n">RecursiveCharacterTextSplitter</span>
<span class="kn">from</span> <span class="nn">langchain.embeddings</span> <span class="kn">import</span> <span class="n">OpenAIEmbeddings</span>
<span class="kn">from</span> <span class="nn">langchain.vectorstores</span> <span class="kn">import</span> <span class="n">Chroma</span>
<span class="kn">from</span> <span class="nn">langchain.chat_models</span> <span class="kn">import</span> <span class="n">ChatOpenAI</span>
<span class="kn">from</span> <span class="nn">langchain.prompts</span> <span class="kn">import</span> <span class="n">ChatPromptTemplate</span>
<span class="kn">from</span> <span class="nn">langchain.schema.runnable</span> <span class="kn">import</span> <span class="n">RunnablePassthrough</span>
<span class="kn">from</span> <span class="nn">langchain.schema.output_parser</span> <span class="kn">import</span> <span class="n">StrOutputParser</span>

<span class="k">class</span> <span class="nc">MedicalRAGSystem</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs_directory</span><span class="p">,</span> <span class="n">persist_directory</span><span class="o">=</span><span class="s">"./chroma_db"</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">docs_directory</span> <span class="o">=</span> <span class="n">docs_directory</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">persist_directory</span> <span class="o">=</span> <span class="n">persist_directory</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">embeddings</span> <span class="o">=</span> <span class="n">OpenAIEmbeddings</span><span class="p">(</span><span class="n">openai_api_key</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"OPENAI_API_KEY"</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">llm</span> <span class="o">=</span> <span class="n">ChatOpenAI</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s">"gpt-3.5-turbo"</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">openai_api_key</span><span class="o">=</span><span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">"OPENAI_API_KEY"</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">vectorstore</span> <span class="o">=</span> <span class="bp">None</span>
        
    <span class="k">def</span> <span class="nf">load_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Load all PDF documents from directory"""</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="n">DirectoryLoader</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">docs_directory</span><span class="p">,</span>
            <span class="n">glob</span><span class="o">=</span><span class="s">"**/*.pdf"</span><span class="p">,</span>
            <span class="n">loader_cls</span><span class="o">=</span><span class="n">PyPDFLoader</span>
        <span class="p">)</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span><span class="si">}</span><span class="s"> document pages"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">documents</span>
    
    <span class="k">def</span> <span class="nf">create_chunks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">documents</span><span class="p">):</span>
        <span class="s">"""Split documents into chunks"""</span>
        <span class="n">text_splitter</span> <span class="o">=</span> <span class="n">RecursiveCharacterTextSplitter</span><span class="p">(</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
            <span class="n">chunk_overlap</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">separators</span><span class="o">=</span><span class="p">[</span><span class="s">"</span><span class="se">\n\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">". "</span><span class="p">,</span> <span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="n">text_splitter</span><span class="p">.</span><span class="n">split_documents</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="si">}</span><span class="s"> chunks"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">chunks</span>
    
    <span class="k">def</span> <span class="nf">create_vectorstore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chunks</span><span class="p">):</span>
        <span class="s">"""Create and persist vector store"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">vectorstore</span> <span class="o">=</span> <span class="n">Chroma</span><span class="p">.</span><span class="n">from_documents</span><span class="p">(</span>
            <span class="n">documents</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
            <span class="n">embedding</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">embeddings</span><span class="p">,</span>
            <span class="n">persist_directory</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">persist_directory</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">vectorstore</span><span class="p">.</span><span class="n">persist</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Vector store created and persisted"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">load_vectorstore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Load existing vector store"""</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">vectorstore</span> <span class="o">=</span> <span class="n">Chroma</span><span class="p">(</span>
            <span class="n">persist_directory</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">persist_directory</span><span class="p">,</span>
            <span class="n">embedding_function</span><span class="o">=</span><span class="bp">self</span><span class="p">.</span><span class="n">embeddings</span>
        <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Vector store loaded"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">create_rag_chain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">"""Create the RAG chain"""</span>
        <span class="c1"># Custom prompt template
</span>        <span class="n">template</span> <span class="o">=</span> <span class="s">"""You are a medical assistant helping healthcare professionals find information from hospital protocols.
        
        Use the following pieces of context to answer the question. If you don't know the answer based on the context, say so.
        Always cite which document or section your answer comes from.
        
        Context:
        {context}
        
        Question: {question}
        
        Answer:"""</span>
        
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">.</span><span class="n">from_template</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        
        <span class="c1"># Create retriever
</span>        <span class="n">retriever</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">vectorstore</span><span class="p">.</span><span class="n">as_retriever</span><span class="p">(</span>
            <span class="n">search_type</span><span class="o">=</span><span class="s">"similarity_score_threshold"</span><span class="p">,</span>
            <span class="n">search_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s">"score_threshold"</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span> <span class="s">"k"</span><span class="p">:</span> <span class="mi">4</span><span class="p">}</span>
        <span class="p">)</span>
        
        <span class="c1"># Create chain
</span>        <span class="k">def</span> <span class="nf">format_docs</span><span class="p">(</span><span class="n">docs</span><span class="p">):</span>
            <span class="n">formatted</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'source'</span><span class="p">,</span> <span class="s">'Unknown'</span><span class="p">)</span>
                <span class="n">content</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="n">page_content</span>
                <span class="n">formatted</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s">"Source: </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="se">\n</span><span class="s">Content: </span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="s">"</span><span class="se">\n</span><span class="s">---</span><span class="se">\n</span><span class="s">"</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted</span><span class="p">)</span>
        
        <span class="n">rag_chain</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s">"context"</span><span class="p">:</span> <span class="n">retriever</span> <span class="o">|</span> <span class="n">format_docs</span><span class="p">,</span> <span class="s">"question"</span><span class="p">:</span> <span class="n">RunnablePassthrough</span><span class="p">()}</span>
            <span class="o">|</span> <span class="n">prompt</span>
            <span class="o">|</span> <span class="bp">self</span><span class="p">.</span><span class="n">llm</span>
            <span class="o">|</span> <span class="n">StrOutputParser</span><span class="p">()</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">rag_chain</span>
    
    <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">question</span><span class="p">):</span>
        <span class="s">"""Query the RAG system"""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">vectorstore</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">load_vectorstore</span><span class="p">()</span>
        
        <span class="n">rag_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">create_rag_chain</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">rag_chain</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

<span class="c1"># Usage
</span><span class="n">rag_system</span> <span class="o">=</span> <span class="n">MedicalRAGSystem</span><span class="p">(</span><span class="s">"./medical_docs"</span><span class="p">)</span>

<span class="c1"># First time setup
</span><span class="n">documents</span> <span class="o">=</span> <span class="n">rag_system</span><span class="p">.</span><span class="n">load_documents</span><span class="p">()</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="n">rag_system</span><span class="p">.</span><span class="n">create_chunks</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
<span class="n">rag_system</span><span class="p">.</span><span class="n">create_vectorstore</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>

<span class="c1"># Query the system
</span><span class="n">response</span> <span class="o">=</span> <span class="n">rag_system</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="s">"What is the protocol for chest pain patients?"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div></div>

<p>This worked much better! The answers were more accurate and included source citations.</p>

<h2 id="the-challenges-i-didnt-expect">The Challenges I Didn‚Äôt Expect</h2>

<h3 id="1-pdf-quality-issues">1. PDF Quality Issues</h3>

<p>Medical documents are often scanned PDFs with poor text extraction. Some protocols came out as gibberish:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"Pati3nt with ch3st p@in should b3 ass3ss3d..."
</code></pre></div></div>

<p><strong>Solution</strong>: I had to preprocess documents and sometimes manually clean the worst ones.</p>

<h3 id="2-medical-terminology">2. Medical Terminology</h3>

<p>Standard embeddings don‚Äôt understand medical context well. ‚ÄúMI‚Äù (myocardial infarction) and ‚Äúheart attack‚Äù should be similar, but weren‚Äôt always treated as such.</p>

<p><strong>Partial solution</strong>: I added a preprocessing step to expand common medical abbreviations:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">expand_medical_terms</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">abbreviations</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">"MI"</span><span class="p">:</span> <span class="s">"myocardial infarction"</span><span class="p">,</span>
        <span class="s">"BP"</span><span class="p">:</span> <span class="s">"blood pressure"</span><span class="p">,</span>
        <span class="s">"HR"</span><span class="p">:</span> <span class="s">"heart rate"</span><span class="p">,</span>
        <span class="s">"SOB"</span><span class="p">:</span> <span class="s">"shortness of breath"</span><span class="p">,</span>
        <span class="c1"># ... many more
</span>    <span class="p">}</span>
    
    <span class="k">for</span> <span class="n">abbrev</span><span class="p">,</span> <span class="n">full_term</span> <span class="ow">in</span> <span class="n">abbreviations</span><span class="p">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">abbrev</span><span class="p">,</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">abbrev</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">full_term</span><span class="si">}</span><span class="s">)"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">text</span>
</code></pre></div></div>

<h3 id="3-context-window-limitations">3. Context Window Limitations</h3>

<p>Sometimes the relevant information was spread across multiple chunks, but the LLM‚Äôs context window couldn‚Äôt fit all of them.</p>

<p><strong>Solution</strong>: I implemented a two-stage retrieval:</p>
<ol>
  <li>First pass: Get top 10 relevant chunks</li>
  <li>Second pass: Re-rank and select top 3 most relevant</li>
</ol>

<h3 id="4-hallucination-issues">4. Hallucination Issues</h3>

<p>Even with good context, the LLM sometimes made up information or mixed details from different protocols.</p>

<p><strong>Solution</strong>: More specific prompting and temperature settings:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">template</span> <span class="o">=</span> <span class="s">"""You are a medical protocol assistant. You must ONLY use information from the provided context.

IMPORTANT RULES:
- If the context doesn't contain the answer, say "I don't have information about this in the provided protocols"
- Never make up medical advice
- Always cite the specific document and section
- If you're uncertain, say so

Context:
{context}

Question: {question}

Answer:"""</span>
</code></pre></div></div>

<h2 id="production-deployment">Production Deployment</h2>

<p>Getting this running for our medical staff required additional considerations:</p>

<h3 id="1-security-and-privacy">1. Security and Privacy</h3>

<p>Medical documents contain sensitive information. I had to:</p>
<ul>
  <li>Use local embeddings instead of OpenAI (switched to sentence-transformers)</li>
  <li>Run everything on-premises</li>
  <li>Add access controls and audit logging</li>
</ul>

<h3 id="2-user-interface">2. User Interface</h3>

<p>Command-line wasn‚Äôt going to work for busy doctors. I built a simple web interface:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">streamlit</span> <span class="k">as</span> <span class="n">st</span>

<span class="n">st</span><span class="p">.</span><span class="n">title</span><span class="p">(</span><span class="s">"Medical Protocol Assistant"</span><span class="p">)</span>

<span class="c1"># Initialize RAG system
</span><span class="o">@</span><span class="n">st</span><span class="p">.</span><span class="n">cache_resource</span>
<span class="k">def</span> <span class="nf">load_rag_system</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">MedicalRAGSystem</span><span class="p">(</span><span class="s">"./medical_docs"</span><span class="p">)</span>

<span class="n">rag_system</span> <span class="o">=</span> <span class="n">load_rag_system</span><span class="p">()</span>

<span class="c1"># User input
</span><span class="n">question</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="n">text_input</span><span class="p">(</span><span class="s">"Ask about medical protocols:"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">question</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">st</span><span class="p">.</span><span class="n">spinner</span><span class="p">(</span><span class="s">"Searching protocols..."</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">rag_system</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">question</span><span class="p">)</span>
        <span class="n">st</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-performance-optimization">3. Performance Optimization</h3>

<p>Initial queries took 10-15 seconds. For busy medical staff, that‚Äôs too slow. Optimizations:</p>
<ul>
  <li>Cached embeddings</li>
  <li>Smaller, more focused vector store</li>
  <li>Faster embedding model</li>
  <li>Query result caching</li>
</ul>

<p>Final response time: 2-3 seconds.</p>

<h2 id="what-i-learned">What I Learned</h2>

<h3 id="1-rag-is-more-than-just-embeddings--llm">1. RAG is More Than Just ‚ÄúEmbeddings + LLM‚Äù</h3>

<p>The quality depends heavily on:</p>
<ul>
  <li>Document preprocessing</li>
  <li>Chunking strategy</li>
  <li>Retrieval parameters</li>
  <li>Prompt engineering</li>
  <li>Post-processing</li>
</ul>

<h3 id="2-domain-specific-challenges-are-real">2. Domain-Specific Challenges Are Real</h3>

<p>Generic tutorials don‚Äôt prepare you for:</p>
<ul>
  <li>Poor document quality</li>
  <li>Domain-specific terminology</li>
  <li>Regulatory requirements</li>
  <li>User expectations</li>
</ul>

<h3 id="3-evaluation-is-hard">3. Evaluation is Hard</h3>

<p>How do you know if your RAG system is working well? I ended up creating a test set of questions with known correct answers and measuring:</p>
<ul>
  <li>Retrieval accuracy (did it find the right documents?)</li>
  <li>Answer quality (human evaluation)</li>
  <li>Response time</li>
</ul>

<h3 id="4-iteration-is-key">4. Iteration is Key</h3>

<p>My first version was terrible. The current version (after 3 weeks of iteration) is actually useful. Plan for multiple iterations.</p>

<h2 id="current-status">Current Status</h2>

<p>The system is now in limited production with 20 medical staff. Early feedback:</p>
<ul>
  <li>‚úÖ ‚ÄúMuch faster than searching through PDFs‚Äù</li>
  <li>‚úÖ ‚ÄúAnswers are usually accurate‚Äù</li>
  <li>‚ùå ‚ÄúSometimes can‚Äôt find information I know is there‚Äù</li>
  <li>‚ùå ‚ÄúWish it could handle images and diagrams‚Äù</li>
</ul>

<h2 id="whats-next">What‚Äôs Next</h2>

<p>Planned improvements:</p>
<ol>
  <li><strong>Multi-modal RAG</strong>: Handle images and diagrams in protocols</li>
  <li><strong>Better evaluation</strong>: Automated testing with medical experts</li>
  <li><strong>Conversation memory</strong>: Remember context across questions</li>
  <li><strong>Integration</strong>: Connect with our EMR system</li>
</ol>

<h2 id="for-others-building-rag-systems">For Others Building RAG Systems</h2>

<p><strong>Start simple</strong>: Get basic retrieval working before optimizing
<strong>Focus on data quality</strong>: Garbage in, garbage out applies here too
<strong>Test with real users</strong>: Your assumptions about what works will be wrong
<strong>Plan for iteration</strong>: Your first version won‚Äôt be your last</p>

<p>RAG is powerful, but it‚Äôs not magic. Like any system, it requires careful engineering, testing, and iteration to work well in production.</p>

<hr />

<p><em>Next post: I‚Äôm planning to explore multi-agent systems with CrewAI. The idea of AI agents working together to solve complex problems is fascinating, and I want to see if it lives up to the hype.</em></p>

  </div>

  <!-- Social Share Buttons -->
  <div class="share-buttons">
    <h4>Share this post:</h4>
    <a href="https://twitter.com/intent/tweet?text=Building%20RAG%20Systems:%20My%20Journey%20with%20LangChain&url=http://localhost:4009/2024/10/20/getting-started-langchain-rag/" 
       class="share-button" target="_blank" rel="noopener" aria-label="Share on Twitter">
      üê¶ Twitter
    </a>
    <a href="https://www.linkedin.com/sharing/share-offsite/?url=http://localhost:4009/2024/10/20/getting-started-langchain-rag/" 
       class="share-button" target="_blank" rel="noopener" aria-label="Share on LinkedIn">
      üíº LinkedIn
    </a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4009/2024/10/20/getting-started-langchain-rag/" 
       class="share-button" target="_blank" rel="noopener" aria-label="Share on Facebook">
      üìò Facebook
    </a>
    <button class="share-button" onclick="copyToClipboard('http://localhost:4009/2024/10/20/getting-started-langchain-rag/')" aria-label="Copy link">
      üîó Copy Link
    </button>
  </div>

  <!-- AI-Powered Recommendations -->
  <div class="recommendations">
    <h3>Recommended for you</h3>
    <div class="recommended-posts">
      
      
      
      
        <div class="post-card">
          <div class="post-image">üí°</div>
          <h4><a href="/2025/08/20/ai-model-selection-strategies/">AI Model Selection: When to Use GPT vs Claude vs Open Source Models</a></h4>
          <div class="post-meta">August 20, 2025</div>
          <div class="post-excerpt">After using different AI models for 8 months, I've learned when each one shines. Here's my practical guide to choosing...</div>
        </div>
      
        <div class="post-card">
          <div class="post-image">üí°</div>
          <h4><a href="/2025/06/15/voice-ai-integration-streamlit/">Voice AI Integration: Adding Speech to My AI Applications with Streamlit</a></h4>
          <div class="post-meta">June 15, 2025</div>
          <div class="post-excerpt">I added voice capabilities to my AI applications. Here's how I integrated speech-to-text and text-to-speech with Streamlit for hands-free AI...</div>
        </div>
      
        <div class="post-card">
          <div class="post-image">üí°</div>
          <h4><a href="/2025/04/10/building-multi-agent-systems-crewai/">Building Multi-Agent Systems with CrewAI: Beyond Single AI Assistants</a></h4>
          <div class="post-meta">April 10, 2025</div>
          <div class="post-excerpt">I built my first multi-agent system using CrewAI. Here's what I learned about orchestrating multiple AI agents to solve complex...</div>
        </div>
      
        <div class="post-card">
          <div class="post-image">üí°</div>
          <h4><a href="/2025/02/20/chain-of-thought-prompting-business-logic/">Chain-of-Thought Prompting: Improving AI Reasoning in Business Applications</a></h4>
          <div class="post-meta">February 20, 2025</div>
          <div class="post-excerpt">Can we get LLMs to reason through complex business rules reliably? My experiments with chain-of-thought prompting for healthcare protocols.</div>
        </div>
      
        <div class="post-card">
          <div class="post-image">üí°</div>
          <h4><a href="/2025/01/15/advanced-prompt-engineering-techniques/">Advanced Prompt Engineering: Techniques I've Learned from 6 Months with LLMs</a></h4>
          <div class="post-meta">January 15, 2025</div>
          <div class="post-excerpt">After 6 months of working with LLMs daily, I've discovered prompt engineering is both an art and a science. Here...</div>
        </div>
      
        <div class="post-card">
          <div class="post-image">üí°</div>
          <h4><a href="/2024/12/15/agentic-ai-customer-service-automation/">Building an Agentic AI Customer Service System: A Complete Case Study</a></h4>
          <div class="post-meta">December 15, 2024</div>
          <div class="post-excerpt">How I built a multi-agent customer service system that reduced response time by 85% and improved satisfaction scores by 40%...</div>
        </div>
      
        <div class="post-card">
          <div class="post-image">üí°</div>
          <h4><a href="/2024/09/10/ai-powered-data-quality-monitoring/">AI-Powered Data Quality Monitoring: The Future of Data Reliability</a></h4>
          <div class="post-meta">September 10, 2024</div>
          <div class="post-excerpt">Discover how artificial intelligence is revolutionizing data quality monitoring with automated anomaly detection, intelligent alerting, and predictive data health insights....</div>
        </div>
      
        <div class="post-card">
          <div class="post-image">üí°</div>
          <h4><a href="/2024/06/20/advanced-kafka-streaming-patterns/">Advanced Kafka Streaming Patterns for Real-Time Analytics</a></h4>
          <div class="post-meta">June 20, 2024</div>
          <div class="post-excerpt">Explore advanced Apache Kafka streaming patterns including exactly-once processing, windowing operations, and complex event processing for building robust real-time analytics...</div>
        </div>
      
        <div class="post-card">
          <div class="post-image">üí°</div>
          <h4><a href="/2024/03/15/building-enterprise-ai-customer-support-system/">Building an Enterprise AI Customer Support System: From Concept to $485K Annual Savings</a></h4>
          <div class="post-meta">March 15, 2024</div>
          <div class="post-excerpt">How I built a Fortune 500-grade multi-agent customer support system using 100% free technologies, achieving 85% faster response times and...</div>
        </div>
      
        <div class="post-card">
          <div class="post-image">üí°</div>
          <h4><a href="/2023/04/20/mlops-deployment-strategies/">MLOps: Machine Learning Deployment Strategies</a></h4>
          <div class="post-meta">April 20, 2023</div>
          <div class="post-excerpt">MLOps: Machine Learning Deployment Strategies

</div>
        </div>
      
    </div>
  </div>

  <!-- Comments Section -->
  
</article>

<script>
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
      alert('Link copied to clipboard!');
    });
  }
</script>
    </main>
    
    <!-- WhatsApp Chat Widget -->
    <div class="whatsapp-chat" id="whatsapp-chat">
        <div class="chat-bubble">
            <svg viewBox="0 0 24 24" fill="white">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
            </svg>
        </div>
        <div class="chat-tooltip">Chat with me on WhatsApp!</div>
    </div>

    <footer role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Connect</h4>
                    <div class="social-links">
                        <a href="https://github.com/niranjanagaram" aria-label="GitHub Profile">GitHub</a>
                        <a href="https://linkedin.com/in/niranjan-agaram" aria-label="LinkedIn Profile">LinkedIn</a>
                        <a href="mailto:niranjan@example.com" aria-label="Email Contact">Email</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Subscribe</h4>
                    <a href="/feed.xml" aria-label="RSS Feed">RSS Feed</a>
                </div>
            </div>
            <p>&copy; 2025 Niranjan's AI Insights. All rights reserved.</p>
        </div>
    </footer>
    
    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
        }
        
        // Modern Theme Toggle
        const themeToggle = document.getElementById('theme-toggle');
        const currentTheme = localStorage.getItem('theme') || 'dark';
        
        document.documentElement.setAttribute('data-theme', currentTheme);
        
        themeToggle.addEventListener('click', () => {
            const theme = document.documentElement.getAttribute('data-theme');
            const newTheme = theme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });
        
        // Reading Progress
        window.addEventListener('scroll', () => {
            const progress = document.getElementById('reading-progress');
            const scrolled = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
            progress.style.width = scrolled + '%';
        });
        

    </script>
</body>
</html>